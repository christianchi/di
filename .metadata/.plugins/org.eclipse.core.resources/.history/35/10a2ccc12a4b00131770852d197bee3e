package com.dam.di.contextualactionmode;

import java.util.ArrayList;
import java.util.List;

import android.app.Activity;
import android.app.ListActivity;
import android.os.Bundle;
import android.view.ActionMode;
import android.view.LayoutInflater;
import android.view.Menu;
import android.view.MenuInflater;
import android.view.MenuItem;
import android.view.View;
import android.view.ViewGroup;
import android.widget.ArrayAdapter;
import android.widget.CheckBox;
import android.widget.ListView;
import android.widget.Toast;

public class MainActivity extends ListActivity {

	ListView lista;
	List<Usuario> listaUsuario;
	public int selectedItem = -1, contadorCheck = 0;

	/** Called when the activity is first created. */

	public void onCreate(Bundle icicle) {
		super.onCreate(icicle);
		// create an array of Strings, that will be put to our ListActivity
		ArrayAdapter<Usuario> adapter = new UsuarioArrayAdapter(this,
				getModel());
		setListAdapter(adapter);
	}

	private List<Usuario> getModel() {
		listaUsuario = new ArrayList<Usuario>();
		listaUsuario.add(new Usuario("Miguel"));
		listaUsuario.add(new Usuario("Rebeca"));
		listaUsuario.add(new Usuario("Rebeca Campos"));
		listaUsuario.add(new Usuario("Olivia"));
		listaUsuario.add(new Usuario("Miriam"));
		
		listaUsuario.get(1).setSeleccionado(true);
		return listaUsuario;
	}

	private Usuario get(String s) {
		return new Usuario(s);
	}

	// Adaptador de items de tipo Usuario
	class AdaptadorUsuario extends ArrayAdapter<Usuario> {
		CheckBox check;

		Activity context;

		AdaptadorUsuario(Activity context) {
			super(context, R.layout.user_list_item, listaUsuario);
			this.context = context;
		}

		public View getView(int position, View convertView, ViewGroup parent) {
			selectedItem = position;
			View item = convertView;
			LayoutInflater inflater = context.getLayoutInflater();

			item = inflater.inflate(R.layout.user_list_item, null);

			check = (CheckBox) item.findViewById(R.id.checkUsuario);

			Usuario usuario = listaUsuario.get(position);
			check.setText(usuario.getNombre());

			check.setOnClickListener(new View.OnClickListener() {

				@Override
				public void onClick(View viewCheck) {
					String titulo = "";

					if (((CheckBox) viewCheck).isChecked()) { // Si checkbox =
																// checked
						// Incremento el contador de checkboxes
						contadorCheck++;

						// Compruebo si el actionMode se ha instanciado ya
						if (mActionMode == null) {
							mActionMode = MainActivity.this
									.startActionMode(mActionModeCallback);
						} else {
							// Marco en la lista que el elemento con la posici—n
							// = selectedItem
							// est‡ chequeado.
							lista.setItemChecked(selectedItem, true);
						}

						if (contadorCheck == 1) {
							titulo = contadorCheck + " seleccionado";
						} else {
							titulo = contadorCheck + " seleccionados";
						}
						mActionMode.setTitle(titulo);

					} else { // Si checkbox != checked
						// Lo primero que hago es indicar que el elemento del
						// ListView lista,
						// que ocupa la posici—n selectedItem no est‡ chequeado
						// = false.
						lista.setItemChecked(selectedItem, false);
						contadorCheck--;
						if (contadorCheck == 0) {
							// finalizo el actionMode = que el actionBar vuelva
							// a su estado
							// original
							mActionMode.finish();
						} else {
							if (contadorCheck == 1) {
								titulo = contadorCheck + " seleccionado";
							} else {
								titulo = contadorCheck + " seleccionados";
							}
							mActionMode.setTitle(titulo);
						}
					}

				}
			});

			return (item);
		}
	}

}
